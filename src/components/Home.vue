<template>
    <div class="home-ctn" :class="logedIn?'home-ctn-in':''">
        <loading v-if="loading"></loading>
        <div class="home-bg" :style="loading?'opacity:0;':'opacity:1;'"></div>
        <div class="user-ctn" v-if="logedIn" @click.self="closeSetting" :style="showList?'top:-100vh':''">
            <span class="iconfont user-setting-btn" @click="toggleSetting">&#xe61f;</span>
            <transition name="slide-fade">
                <div class="user-setting" v-show="showSetting">
                    <h6>修改用户名</h6>
                    <div class="text">
                        <label><input type="text" @change="userUpdate" autocomplete="off" spellcheck="false" v-model="user.name"></label>
                    </div>
                    <div class="home-btn home-btn_logout" @click="logout">登出</div>
                </div>
            </transition>
            <label for="avatar" class="user-avatar" :style="user.thumb?'background:url('+ user.thumb +') no-repeat center/cover;':''">
                <span class="iconfont default-avatar" v-show="!user.thumb">&#xe655;</span>
            </label>
            <div class="cropper" @dblclick="uploadAvatar" v-show="options.show">
                <vue-cropper
                        ref="cropper"
                        :img="options.img"
                        :outputSize="options.size"
                        :outputType="options.outputType"
                        :info="options.info"
                        :fixed="options.fixed"
                        :fixedNumber="options.fixedNumber"
                        :canScale="options.canScale"
                        :autoCrop="options.autoCrop"
                        :autoCropWidth="options.width"
                        :autoCropHeight="options.height"
                ></vue-cropper>
            </div>
            <input id="avatar" type="file" @change="choseAvatar" accept="image/png, image/jpeg, image/gif, image/jpg">
            <div class="user-info">
                <span>{{user.name}}</span>
            </div>
            <div class="home-btns">
                <div class="home-btn" @click="goToList">作品</div>
                <div class="home-btn" @click="goToWork">绘音</div>
            </div>
        </div>
        <div class="login-ctn" v-if="!logedIn">
            <!--<span class="home-desc_top">音乐和色彩，果然是最能打动人心的两样物事</span>-->
            <!--<span class="home-desc_bottom">将你感动的旋律绘出来吧</span>-->
            <!--<h1 class="home-title">绘音</h1>-->
            <svg :style="loading?'opacity:0;':'opacity:1;'" version="1.1" id="title" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
	 width="348px" height="305px" viewBox="0 0 348 305" enable-background="new 0 0 348 305" xml:space="preserve">
<path fill-rule="evenodd" clip-rule="evenodd" fill="#181423" d="M117,2c0.333,1,0.667,2,1,3c0.333,0,0.667,0,1,0c0,0.667,0,1.333,0,2
	c0.333,0,0.667,0,1,0c1.227,3.79-2.985,8.043-4,10c-0.333,1.667-0.667,3.333-1,5c-1.744,4.308-3.601,7.978-4,14
	c2.406,2.083,2.229,5.171,4,8c0.667,0.333,1.333,0.667,2,1c0,0.667,0,1.333,0,2l2,2c0,0.667,0,1.333,0,2c0.333,0,0.667,0,1,0
	c0.333,1,0.667,2,1,3c0.667,0.333,1.333,0.667,2,1c0,0.667,0,1.333,0,2c0.667,0.333,1.333,0.667,2,1c0,0.667,0,1.333,0,2
	c0.333,0,0.667,0,1,0c0.333,1,0.667,2,1,3c0.667,0.333,1.333,0.667,2,1c0,0.667,0,1.333,0,2c1,0.667,2,1.333,3,2
	c0,0.667,0,1.333,0,2c2,1.667,4,3.333,6,5c0,0.667,0,1.333,0,2c0.667,0.333,1.333,0.667,2,1c1,1.333,2,2.667,3,4
	c0.667,0,1.333,0,2,0c1,1.333,2,2.667,3,4c0.667,0,1.333,0,2,0c0.667,1,1.333,2,2,3c0.667,0,1.333,0,2,0
	c0.333,0.667,0.667,1.333,1,2c0.667,0,1.333,0,2,0c0.667,1,1.333,2,2,3c0.667,0,1.333,0,2,0c0.333,0.667,0.667,1.333,1,2
	c1,0.333,2,0.667,3,1c0,0.333,0,0.667,0,1c0.667,0,1.333,0,2,0c0.333,0.667,0.667,1.333,1,2c1,0.333,2,0.667,3,1
	c0,0.333,0,0.667,0,1c1.333,0.333,2.667,0.667,4,1c0,0.333,0,0.667,0,1c1.333,0.333,2.667,0.667,4,1c0,0.333,0,0.667,0,1
	c2,0.333,4,0.667,6,1c0.667,1,1.333,2,2,3c1.333,0.333,2.667,0.667,4,1c0,0.333,0,0.667,0,1c3,0.333,6,0.667,9,1
	c0,0.333,0,0.667,0,1c1.333,0,2.667,0,4,0c0,0.333,0,0.667,0,1c1.333,0,2.667,0,4,0c0,0.333,0,0.667,0,1c3,0,6,0,9,0c3,2,6,4,9,6
	c-0.577-1.528-0.762-1.641-1-4c8.032,1.57,17.283,2.548,26,0c2,0,4,0,6,0c5.147-1.609,9.846-4.58,16-5c2.571,4.338,6.587,5.21,7,12
	c-2.732,1.688-3.16,4.369-5,7c-1,0.667-2,1.333-3,2c0,0.667,0,1.333,0,2c-0.667,0.333-1.333,0.667-2,1c0,0.333,0,0.667,0,1
	c0.333,0,0.667,0,1,0c0,0.333,0,0.667,0,1c1.333,0,2.667,0,4,0c0,0.333,0,0.667,0,1c0.667,0,1.333,0,2,0c0,0.333,0,0.667,0,1
	c0.667,0,1.333,0,2,0c0.667,1,1.333,2,2,3c0.667,0,1.333,0,2,0c1,1.333,2,2.667,3,4c0.333,0,0.667,0,1,0c0,0.667,0,1.333,0,2
	c1.333,1,2.667,2,4,3c0,2,0,4,0,6c-3.354,1.875-10.08,8.701-11,13c5.141-0.175,10.785-1.749,15-3c4-0.333,8-0.667,12-1
	c9.129-2.728,21.659-3.82,33-4c1.557,2.445,1.143,0.612,3,2c1.667,2,3.333,4,5,6c0,2.333,0,4.667,0,7c-1,0.333-2,0.667-3,1
	c0,0.333,0,0.667,0,1c-1,0-2,0-3,0c0,0.333,0,0.667,0,1c-1,0-2,0-3,0c0,0.333,0,0.667,0,1c-1.333,0-2.667,0-4,0c0,0.333,0,0.667,0,1
	c-3,0.333-6,0.667-9,1c-0.333,0.667-0.667,1.333-1,2c-0.667,0-1.333,0-2,0c0,0.333,0,0.667,0,1c-3.667,1-7.333,2-11,3
	c-5.7-12.909-21.617-3.632-34-3c0,2,0,4,0,6c0.333,0,0.667,0,1,0c0,0.333,0,0.667,0,1c1.333,0,2.667,0,4,0c0,0.333,0,0.667,0,1
	c1.667,0,3.333,0,5,0c1.333,1.667,2.667,3.333,4,5c0.333,0,0.667,0,1,0c0,0.667,0,1.333,0,2c1,0.667,2,1.333,3,2
	c0,0.667,0,1.333,0,2c0.667,0.333,1.333,0.667,2,1c0,0.667,0,1.333,0,2c0.333,0,0.667,0,1,0c0.667,2,1.333,4,2,6
	c0.333,0,0.667,0,1,0c0,1,0,2,0,3c0.333,0,0.667,0,1,0c0,1.333,0,2.667,0,4c0.333,0,0.667,0,1,0c1.161,4.236-2.131,8.572-3,11
	c0,1.333,0,2.667,0,4c-1.714,5.004-3.372,11.783-5,17c-0.333,3.333-0.667,6.667-1,10c-0.333,0-0.667,0-1,0c0,1.667,0,3.333,0,5
	c-0.333,0-0.667,0-1,0c-3.986,13.171,4.354,24.045-5,33c-0.333,0.667-0.667,1.333-1,2c-4.333,0-8.667,0-13,0
	c-0.614-1.218-1.684-1.485-2-2c0-0.667,0-1.333,0-2c-0.333,0-0.667,0-1,0c0-1,0-2,0-3c-0.333,0-0.667,0-1,0c0-1,0-2,0-3
	c-0.333,0-0.667,0-1,0c0-0.667,0-1.333,0-2c-1.667-2-3.333-4-5-6c-0.667,0-1.333,0-2,0c-0.333-0.667-0.667-1.333-1-2c-4,0-8,0-12,0
	c-2.125,2.026-5.538,0.524-8,0c-0.333-1-0.667-2-1-3c-0.667-0.333-1.333-0.667-2-1c0-1,0-2,0-3c-0.333,0-0.667,0-1,0c0-1,0-2,0-3
	c-0.333,0-0.667,0-1,0c0-1,0-2,0-3c-0.333,0-0.667,0-1,0c0-1.667,0-3.333,0-5c-0.333,0-0.667,0-1,0c0-1.667,0-3.333,0-5
	c-0.333,0-0.667,0-1,0c-0.333-5.666-0.667-11.334-1-17c-0.333,0-0.667,0-1,0c-0.333-6.666-0.667-13.334-1-20c0.333,0,0.667,0,1,0
	c0-0.667,0-1.333,0-2c0.333,0,0.667,0,1,0c0-1,0-2,0-3c2.267-5.185,5.739-10.692,7-17c-2.316-0.875-4.407-1.018-8-1
	c-3.292,5.392-10.351,4.798-17,7c-6.202,2.054-14.605,3.073-21,5c-2.333,0-4.667,0-7,0c-1.443,0.42-8.967,2.531-11,2
	c0-0.333,0-0.667,0-1c-3.667-0.333-7.333-0.667-11-1c0-0.333,0-0.667,0-1c-0.667,0-1.333,0-2,0c0-0.333,0-0.667,0-1c-1,0-2,0-3,0
	c0-0.333,0-0.667,0-1c-0.667,0-1.333,0-2,0c-0.333-0.667-0.667-1.333-1-2c-1.333-0.333-2.667-0.667-4-1
	c-0.333-0.667-0.667-1.333-1-2c-0.333,0-0.667,0-1,0c-0.333-0.667-0.667-1.333-1-2c-0.667,0-1.333,0-2,0c-0.667-1-1.333-2-2-3l-1,1
	c-4,3.667-8,7.333-12,11c-1.333,0-2.667,0-4,0c0-0.333,0-0.667,0-1c-4.999-2.341-6.166-4.45-6-12c2.505-1.612,2.3-3.562,4-6
	c1-0.667,2-1.333,3-2c0-0.667,0-1.333,0-2c1.333-1,2.667-2,4-3c0-0.667,0-1.333,0-2c0.667-0.333,1.333-0.667,2-1c0-1,0-2,0-3
	c-3.097-1.643-1.795-1.898-7-2c0,0.333,0,0.667,0,1c-1.333,0-2.667,0-4,0c0,0.333,0,0.667,0,1c-0.667,0-1.333,0-2,0
	c0,0.333,0,0.667,0,1c-1.667,0.333-3.333,0.667-5,1c0,0.333,0,0.667,0,1c-0.667,0-1.333,0-2,0l-2,2c-0.667,0-1.333,0-2,0
	c-0.333,0.667-0.667,1.333-1,2c-1.333,0.333-2.667,0.667-4,1c-0.333,0.667-0.667,1.333-1,2c-1.333,0.333-2.667,0.667-4,1
	c-0.333,0.667-0.667,1.333-1,2c-2.795,1.842-4.699,2.71-9,3c-1.722-1.999-2.325-0.844-4-2c-2-2.333-4-4.667-6-7
	c-0.047-4.845,0.322-8.846,2-12c0.333,0,0.667,0,1,0c0-0.667,0-1.333,0-2c0.667-0.333,1.333-0.667,2-1c0.667-2,1.333-4,2-6
	c0.667-0.333,1.333-0.667,2-1c0-0.667,0-1.333,0-2c0.667-0.333,1.333-0.667,2-1c0-0.667,0-1.333,0-2c0.667-0.333,1.333-0.667,2-1
	c0-0.667,0-1.333,0-2c0.333,0,0.667,0,1,0c0.333-1,0.667-2,1-3c0.667-0.333,1.333-0.667,2-1c0-0.667,0-1.333,0-2
	c0.667-0.333,1.333-0.667,2-1c0-0.667,0-1.333,0-2c0.667-0.333,1.333-0.667,2-1c1.581-1.917,1.746-3.617,2-7c-0.333,0-0.667,0-1,0
	c0-0.333,0-0.667,0-1c-4,1.333-8,2.667-12,4c0,0.333,0,0.667,0,1c-0.667,0-1.333,0-2,0c0,0.333,0,0.667,0,1c-1,0-2,0-3,0
	c0,0.333,0,0.667,0,1c-0.667,0-1.333,0-2,0c0,0.333,0,0.667,0,1c-1,0-2,0-3,0c0,0.333,0,0.667,0,1c-2.573,1.219-4.836,1.633-8,2
	c-0.77-3.215-1.508-2.155-2-6c0.667,0,1.333,0,2,0c2.325-3.787,6.307-4.54,10-7c0.333-0.667,0.667-1.333,1-2c0.667,0,1.333,0,2,0
	c0.333-0.667,0.667-1.333,1-2c1.333-0.333,2.667-0.667,4-1c7.063-4.468,13.714-9.651,25-10c3.576,4.074,7.875,2.989,8,11
	c-2.551,2.249-3.071,6.077-5,9c-0.667,0.333-1.333,0.667-2,1c-0.333,1.333-0.667,2.667-1,4c-0.667,0.333-1.333,0.667-2,1
	c0,0.667,0,1.333,0,2c-0.667,0.333-1.333,0.667-2,1c0,0.667,0,1.333,0,2c-1,0.667-2,1.333-3,2c0,0.667,0,1.333,0,2
	c-0.667,0.333-1.333,0.667-2,1c0,0.667,0,1.333,0,2c-0.667,0.333-1.333,0.667-2,1c0,0.667,0,1.333,0,2c-0.667,0.333-1.333,0.667-2,1
	c0,2.333,0,4.667,0,7c1.528,0.577,1.641,0.762,4,1c0-0.333,0-0.667,0-1c2.333-0.333,4.667-0.667,7-1c0-0.333,0-0.667,0-1
	c3.333-0.667,6.667-1.333,10-2c3.346-1.194,5.072-2.721,10-3c0,0.333,0,0.667,0,1c1,0,2,0,3,0c0.333,0.667,0.667,1.333,1,2
	c0.667,0,1.333,0,2,0c0.667,1,1.333,2,2,3c0.667,0,1.333,0,2,0c1.667,2,3.333,4,5,6c0.667,0.333,1.333,0.667,2,1
	c0,0.667,0,1.333,0,2c0.667,0.333,1.333,0.667,2,1c0,2,0,4,0,6c-1.278,1.249-2.562,4.867-3,7c4.666,1.667,9.334,3.333,14,5
	c8.666-0.333,17.334-0.667,26-1c0-0.333,0-0.667,0-1c1.667,0,3.333,0,5,0c0-0.333,0-0.667,0-1c1.667,0,3.333,0,5,0
	c0-0.333,0-0.667,0-1c1.333,0,2.667,0,4,0c0-0.333,0-0.667,0-1c1.333,0,2.667,0,4,0c0-0.333,0-0.667,0-1c1.333,0,2.667,0,4,0
	c11.588-4.136,22.805-8.461,36-11c1-1.333,2-2.667,3-4c0.333,0,0.667,0,1,0c0-2,0-4,0-6c0.333,0,0.667,0,1,0
	c1.094-1.637,1.381-1.677,2-4c-3-1.667-6-3.333-9-5c0-0.667,0-1.333,0-2c-0.667-0.333-1.333-0.667-2-1c-0.333-1.333-0.667-2.667-1-4
	c-0.333,0-0.667,0-1,0c0-2,0-4,0-6c-1.667-1.333-3.333-2.667-5-4c-1.667-2-3.333-4-5-6c-0.667,0-1.333,0-2,0c-0.667-1-1.333-2-2-3
	c-0.667,0-1.333,0-2,0c-0.333-0.667-0.667-1.333-1-2c-0.667,0-1.333,0-2,0c0-0.333,0-0.667,0-1c-2-0.667-4-1.333-6-2
	c0-0.333,0-0.667,0-1c-1,0-2,0-3,0c0-0.333,0-0.667,0-1c-4.333,0.333-8.667,0.667-13,1c0-0.333,0-0.667,0-1c-2-0.333-4-0.667-6-1
	c0-0.333,0-0.667,0-1c-2-0.333-4-0.667-6-1c0-0.333,0-0.667,0-1c-1.333-0.333-2.667-0.667-4-1c0-0.333,0-0.667,0-1c-1,0-2,0-3,0
	c0-0.333,0-0.667,0-1c-2-0.667-4-1.333-6-2c0-0.333,0-0.667,0-1c-0.667,0-1.333,0-2,0c0-0.333,0-0.667,0-1c-2-0.667-4-1.333-6-2
	c-0.333-0.667-0.667-1.333-1-2c-1.333-0.333-2.667-0.667-4-1c-0.333-0.667-0.667-1.333-1-2c-1.333-0.333-2.667-0.667-4-1
	c-0.333-0.667-0.667-1.333-1-2c-0.667,0-1.333,0-2,0c0-0.333,0-0.667,0-1c-1-0.333-2-0.667-3-1c-0.333-0.667-0.667-1.333-1-2
	c-0.667,0-1.333,0-2,0c-0.667-1-1.333-2-2-3c-0.667,0-1.333,0-2,0c-0.333-0.667-0.667-1.333-1-2c-0.667,0-1.333,0-2,0
	c-0.667-1-1.333-2-2-3c-0.667,0-1.333,0-2,0c-1-1.333-2-2.667-3-4c-1,0-2,0-3,0c-0.667-1-1.333-2-2-3c-1-0.333-2-0.667-3-1
	c0-0.667,0-1.333,0-2c-0.667-0.333-1.333-0.667-2-1c0-0.667,0-1.333,0-2c-0.667-0.333-1.333-0.667-2-1c0-0.667,0-1.333,0-2
	c-0.333,0-0.667,0-1,0c0-1,0-2,0-3c-0.333,0-0.667,0-1,0c-0.333-1.333-0.667-2.667-1-4c-0.333,0-0.667,0-1,0c-1-3-2-6-3-9
	c-0.667-0.333-1.333-0.667-2-1c-0.667-2-1.333-4-2-6c-0.667-0.333-1.333-0.667-2-1c0-0.667,0-1.333,0-2c-0.333,0-0.667,0-1,0
	c-1.667-2-3.333-4-5-6c-0.333,0-0.667,0-1,0c0,0.333,0,0.667,0,1c-2.031,1.418-4.786,5.768-6,8c0,0.667,0,1.333,0,2
	c-0.333,0-0.667,0-1,0c0,0.667,0,1.333,0,2c-0.667,0.333-1.333,0.667-2,1c0,1,0,2,0,3c-0.333,0-0.667,0-1,0c0,0.667,0,1.333,0,2
	c-0.333,0-0.667,0-1,0c0,0.667,0,1.333,0,2c-0.333,0-0.667,0-1,0c-0.667,2-1.333,4-2,6c-0.333,0-0.667,0-1,0c0,1,0,2,0,3
	c-0.333,0-0.667,0-1,0c0,0.667,0,1.333,0,2c-0.333,0-0.667,0-1,0c0,0.667,0,1.333,0,2c-0.333,0-0.667,0-1,0c0,0.667,0,1.333,0,2
	c-0.333,0-0.667,0-1,0c0,1,0,2,0,3c-0.333,0-0.667,0-1,0c-0.333,1.333-0.667,2.667-1,4c-0.333,0-0.667,0-1,0c0,1,0,2,0,3
	c-0.333,0-0.667,0-1,0c0,0.667,0,1.333,0,2c-0.333,0-0.667,0-1,0c0,1,0,2,0,3c-0.333,0-0.667,0-1,0c-0.333,1.333-0.667,2.667-1,4
	c-0.333,0-0.667,0-1,0c0,1,0,2,0,3c-0.333,0-0.667,0-1,0c-0.333,1.333-0.667,2.667-1,4c-0.333,0-0.667,0-1,0c0,1,0,2,0,3
	c-0.333,0-0.667,0-1,0c-0.333,1.333-0.667,2.667-1,4c-0.333,0-0.667,0-1,0c0,1,0,2,0,3c-0.333,0-0.667,0-1,0
	c-0.333,1.333-0.667,2.667-1,4c-0.333,0-0.667,0-1,0c0,1,0,2,0,3c-0.333,0-0.667,0-1,0c-0.333,1.333-0.667,2.667-1,4
	c-0.333,0-0.667,0-1,0c0,1,0,2,0,3c-0.333,0-0.667,0-1,0c-0.333,1.333-0.667,2.667-1,4c-0.333,0-0.667,0-1,0c0,1,0,2,0,3
	c-0.333,0-0.667,0-1,0c0,0.667,0,1.333,0,2c-0.333,0-0.667,0-1,0c-2.514,4.875,0.639,7.578-7,8c-3.055-5.126-9.519-6.386-10-14
	c2.723-2.532,1.509-3.715,3-7c0.333,0,0.667,0,1,0c0.333-1.333,0.667-2.667,1-4c0.333,0,0.667,0,1,0c0-0.667,0-1.333,0-2
	c0.667-0.333,1.333-0.667,2-1c0-0.667,0-1.333,0-2c0.333,0,0.667,0,1,0c0-0.667,0-1.333,0-2l2-2c0-0.667,0-1.333,0-2
	c0.333,0,0.667,0,1,0c0.333-1,0.667-2,1-3c0.667-0.333,1.333-0.667,2-1c0.333-1.333,0.667-2.667,1-4c0.667-0.333,1.333-0.667,2-1
	c1-3,2-6,3-9c0.333,0,0.667,0,1,0c0-0.667,0-1.333,0-2c0.333,0,0.667,0,1,0c0.667-2,1.333-4,2-6c0.333,0,0.667,0,1,0c0-1,0-2,0-3
	c0.333,0,0.667,0,1,0c0-0.667,0-1.333,0-2c0.333,0,0.667,0,1,0c0.667-2,1.333-4,2-6c0.333,0,0.667,0,1,0c0-1,0-2,0-3
	c0.333,0,0.667,0,1,0c0-0.667,0-1.333,0-2c0.333,0,0.667,0,1,0c0-0.667,0-1.333,0-2c0.333,0,0.667,0,1,0c0.667-2,1.333-4,2-6
	c0.333,0,0.667,0,1,0c0-1,0-2,0-3c0.333,0,0.667,0,1,0c0-0.667,0-1.333,0-2c0.333,0,0.667,0,1,0c0.667-2,1.333-4,2-6
	c0.333,0,0.667,0,1,0c0-1,0-2,0-3c0.333,0,0.667,0,1,0c0-0.667,0-1.333,0-2c0.333,0,0.667,0,1,0c0.333-1.333,0.667-2.667,1-4
	c0.333,0,0.667,0,1,0c0.333-1.333,0.667-2.667,1-4c0.333,0,0.667,0,1,0c0-1,0-2,0-3c0.333,0,0.667,0,1,0c0.667-2,1.333-4,2-6
	c0.333,0,0.667,0,1,0c0.333-1.667,0.667-3.333,1-5c0.333,0,0.667,0,1,0c0-0.667,0-1.333,0-2c0.333,0,0.667,0,1,0
	c0-0.667,0-1.333,0-2c0.333,0,0.667,0,1,0c0.667-2,1.333-4,2-6c0.333,0,0.667,0,1,0c0-1,0-2,0-3c0.333,0,0.667,0,1,0
	c0.333-1.333,0.667-2.667,1-4c0.333,0,0.667,0,1,0c0-1,0-2,0-3c0.333,0,0.667,0,1,0c0-0.667,0-1.333,0-2
	c0.667-0.333,1.333-0.667,2-1c0-0.667,0-1.333,0-2c1-0.333,2-0.667,3-1c0.333-0.667,0.667-1.333,1-2c1,0,2,0,3,0
	C115.126,1.719,114.632,1.355,117,2z M62,16c1.444,5.379,5.48,4.584,6,12c-1.983,1.767-0.844,1.95-2,4c-0.333,0-0.667,0-1,0
	c0,0.667,0,1.333,0,2c-0.667,0.333-1.333,0.667-2,1c0,0.667,0,1.333,0,2c-1,0.667-2,1.333-3,2c0,0.667,0,1.333,0,2
	c-1,0.667-2,1.333-3,2c0,0.667,0,1.333,0,2c-1.667,1.333-3.333,2.667-5,4c0,0.667,0,1.333,0,2c-0.667,0.333-1.333,0.667-2,1
	c0,0.333,0,0.667,0,1c-0.667,0.333-1.333,0.667-2,1c0,0.667,0,1.333,0,2c-0.667,0.333-1.333,0.667-2,1c0,0.667,0,1.333,0,2
	c-1,0.667-2,1.333-3,2c0,0.667,0,1.333,0,2c-0.333,0-0.667,0-1,0c-0.333,1-0.667,2-1,3c-0.667,0.333-1.333,0.667-2,1
	c0,0.667,0,1.333,0,2c-1,0.667-2,1.333-3,2c0,0.667,0,1.333,0,2c-0.667,0.333-1.333,0.667-2,1c0,0.667,0,1.333,0,2
	c-0.667,0.333-1.333,0.667-2,1c-0.333,1-0.667,2-1,3c-0.333,0-0.667,0-1,0c-0.333,1-0.667,2-1,3c2.884,0.021,6.592,0.613,8,2
	c4.001,1.018,4.38,3.808,7,6c-0.333,4.333-0.667,8.667-1,13c-0.333,0-0.667,0-1,0c0,0.667,0,1.333,0,2c-0.333,0-0.667,0-1,0
	c0,1,0,2,0,3c-0.333,0-0.667,0-1,0c0,0.667,0,1.333,0,2c-0.333,0-0.667,0-1,0c0,0.667,0,1.333,0,2c-0.333,0-0.667,0-1,0
	c-0.333,1.333-0.667,2.667-1,4c-0.667,0.333-1.333,0.667-2,1c-0.333,1.333-0.667,2.667-1,4c-0.902,1.627-6.777,7.652-6,10
	c0.333,0,0.667,0,1,0c1.173,4.511,4.125,6.265,7,9c0.333,0.667,0.667,1.333,1,2c0.667,0,1.333,0,2,0c0.333,0.667,0.667,1.333,1,2
	c0.333,0,0.667,0,1,0c0,2,0,4,0,6c-1.176,1.424-1.81,13.809-1,17c0.333,0,0.667,0,1,0c0,1.333,0,2.667,0,4c-0.333,0-0.667,0-1,0
	c0,1,0,2,0,3c-0.333,0-0.667,0-1,0c0,1,0,2,0,3c-0.333,0-0.667,0-1,0c0,1,0,2,0,3c-0.333,0-0.667,0-1,0c0,1,0,2,0,3
	c-0.333,0-0.667,0-1,0c0,1,0,2,0,3c-0.333,0-0.667,0-1,0c-2.831,7.936,1.315,15.96-9,17c-1.721-1.95-2.414-0.866-4-2
	c0-0.333,0-0.667,0-1c-0.667-0.333-1.333-0.667-2-1c0-0.667,0-1.333,0-2c-0.667-0.333-1.333-0.667-2-1c-1.86-2.818-2.806-5.637-3-10
	c3.414-2.067,4.281-5.154,6-9c0.333,0,0.667,0,1,0c-0.333-3.667-0.667-7.333-1-11c0.333,0,0.667,0,1,0c0-0.667,0-1.333,0-2
	c0.333,0,0.667,0,1,0c0-0.667,0-1.333,0-2c1.88-3.572,4.431-5.839,5-11c-0.333,0-0.667,0-1,0c-0.333-1-0.667-2-1-3
	c-4.108-2.158-7.392,2.002-10,0c-5.772-1.279-9.023-5.78-9-13c1.333-1,2.667-2,4-3c0-0.667,0-1.333,0-2c1.333-1,2.667-2,4-3
	c0-0.667,0-1.333,0-2c4.492-6.622,10.714-12.062,11-23c-5.547,0.288-3.72,1.221-7,3c-3.437,1.864-6.992,2.793-12,3
	c-2.997-5.046-6.825-5.443-7-14c1-0.667,2-1.333,3-2c0-0.667,0-1.333,0-2c1.333-1,2.667-2,4-3c0-0.667,0-1.333,0-2
	c1-0.667,2-1.333,3-2c0-0.667,0-1.333,0-2c1-0.667,2-1.333,3-2c0-0.667,0-1.333,0-2c1.333-1,2.667-2,4-3c0-0.667,0-1.333,0-2
	c1-0.667,2-1.333,3-2c0-0.667,0-1.333,0-2c1-0.667,2-1.333,3-2c0-0.667,0-1.333,0-2c1.333-1,2.667-2,4-3c0-0.667,0-1.333,0-2
	c1-0.667,2-1.333,3-2c0-0.667,0-1.333,0-2c1-0.667,2-1.333,3-2c0-0.667,0-1.333,0-2c1.333-1,2.667-2,4-3c0-0.667,0-1.333,0-2
	c1.333-1,2.667-2,4-3c0.333-1,0.667-2,1-3c1-0.667,2-1.333,3-2c0-0.333,0-0.667,0-1c0.667-0.333,1.333-0.667,2-1
	c0-0.667,0-1.333,0-2c0.667-0.333,1.333-0.667,2-1c2.02-2.227,2.739-3.83,3-8c-0.333,0-0.667,0-1,0c0-1.333,0-2.667,0-4
	c-0.333,0-0.667,0-1,0c0-0.667,0-1.333,0-2c-0.333,0-0.667,0-1,0c-1.151-1.527-1.405-1.741-2-4c3.412-2.037,3.107-3.866,9-4
	C57.281,13.62,59.63,15.396,62,16z M259,70c2.333,0.333,4.667,0.667,7,1c0,0.333,0,0.667,0,1c5.851,1.427,13.921,11.347,17,16
	c0,0.667,0,1.333,0,2c0.667,0.333,1.333,0.667,2,1c0.333,1.333,0.667,2.667,1,4c0.333,0,0.667,0,1,0c0,2.667,0,5.333,0,8
	c-4.781,2.558-8.83,5.609-16,6c-1.139-1.139-0.003-0.398-2-1c-1.656-3.643-2.942-5.233-3-11c2.136-1.779,2.867-4.125,3-8
	c-2.971-1.767-3.243-3.97-5-7c-0.333,0-0.667,0-1,0c0-0.667,0-1.333,0-2c-0.667-0.333-1.333-0.667-2-1C260.333,76,259.667,73,259,70
	z M114,98c0,0.667,0,1.333,0,2c3.461,1.997,5.06,5.576,8,8c0,1.667,0,3.333,0,5c-1.333,0.333-2.667,0.667-4,1c0,0.333,0,0.667,0,1
	c-6.333,1-12.667,2-19,3c-3.45-6-13.486-12.555-14-20c1-0.333,2-0.667,3-1c1.599-1.541,10.898-3.132,15-2c0,0.333,0,0.667,0,1
	c2.333-0.333,4.667-0.667,7-1c0,0.333,0,0.667,0,1C111.693,97.057,111.658,97.349,114,98z M250,140c-0.333,0-0.667,0-1,0
	c0,0.667,0,1.333,0,2c-0.333,0-0.667,0-1,0c-0.854,1.127,0.135,0.156-1,1c-1.591-3.47-3.761-7.143-7-9c0-0.333,0-0.667,0-1
	c4,0.667,8,1.333,12,2C251.659,137.975,251.391,138.307,250,140z M254,212c-0.667,0-1.333,0-2,0c-0.333,0.667-0.667,1.333-1,2
	c-1,0-2,0-3,0c0,0.333,0,0.667,0,1c-1,0-2,0-3,0c0-0.333,0-0.667,0-1c-0.333,0-0.667,0-1,0c0-1,0-2,0-3c-0.333,0-0.667,0-1,0
	c-0.041-4.056,0.003-8.349,1-11c6.538-1.327,11.111-3.34,18-2C261.451,204.077,257.915,209.383,254,212z M280,205
	c0,0.333,0,0.667,0,1c13.084,3.5,5.786,32.412,2,42c0,1,0,2,0,3c-0.333,0-0.667,0-1,0c0,0.667,0,1.333,0,2c-0.333,0-0.667,0-1,0
	c-1.418,3.247-0.436,4.803-3,7c0.08,7.726,0.59,15.045-2,20c-6.758-0.858-8.27-6.21-13-9c0.029-7.159,1.67-9.438,5-13
	c0.667-0.333,1.333-0.667,2-1c0-0.667,0-1.333,0-2c1-0.667,2-1.333,3-2c1.755-2.491,2.762-6.084,5-8c-0.72-6.167-12.192-16.48-17-19
	c0.606-5.646,7.393-16.509,11-19c1.671-1.154,2.27-0.018,4-2C276.667,205,278.333,205,280,205z M248,250
	c-0.144-4.222-0.504-7.337,2-9c0-0.333,0-0.667,0-1c2.589,1.256,7.131,0.977,9,3c1,0.333,2,0.667,3,1c0,1.333,0,2.667,0,4
	c-1,0.667-2,1.333-3,2c-2,2.667-4,5.333-6,8c-1,0-2,0-3,0C249.7,256.228,249.05,251.155,248,250z" />
</svg>

            <div class="home-btns">
                <!--<div class="home-btn" @click="goToList">作品列表</div>-->
                <div class="shining-btn" @click="showLogin">❀</div>
            </div>
            <login :show="show"></login>
        </div>
        <list :style="showList?'top:0':''" :show.sync="showList" :user="user.name" :list="works"></list>
    </div>
</template>

<script>
  import VueCropper from 'vue-cropper';
  import Vivus from 'vivus';
  import Login from './Login.vue';
  import Loading from './Loading.vue';
  import List from './List.vue';
  import serverUrl from '../scripts/url';
  import showToast from '../scripts/showToast';
  import getBlobBydataURI from '../scripts/getBlobBydataURI';
  import elParallax from '../scripts/elParallax';

  export default {
    components: { Login, Loading, List, VueCropper },
    data: function () {
      return {
        options: {
          show: false,
          img: '',
          info: true,
          size: 1,
          outputType: 'jpeg',
          canScale: false,
          autoCrop: true,
          // 只有自动截图开启 宽度高度才生效
          width: 300,
          height: 300,
          // 开启宽度和高度比例
          fixed: true,
          fixedNumber: [1, 1]
        },
        show: 'none',
        logedIn: false,
        loading: true,
        showList: false,
        showSetting: false,
        user: {
          id: null,
          name: '',
          email: '',
          avatar: '',
          thumb: ''
        },
        works: []
      };
    },
    created: function () {
      let that = this;
      fetch(serverUrl + '/api/loggedIn', {
        method: 'POST',
        credentials: 'include',
        mode: 'cors',
        cache: 'default'
      }).then((res) => {
        return res.json();
      }).then((data) => {
        if (typeof data.id !== 'undefined') {
          that.user.name = data.username;
          that.user.id = data.id;
          that.user.email = data.email;
          that.user.avatar = data.avatar;
          that.user.thumb = data.thumb;
          that.logedIn = true;
        }
        that.loading = false;
      }).catch((err) => {
        return err.toString();
      });
    },
    methods: {
      goToList: function () {
        this.showList = true;
      },
      showLogin: function () {
        this.show = 'login';
      },
      goToWork: function () {
        this.$router.push('work');
      },
      toggleSetting: function () {
        this.showSetting = !this.showSetting;
      },
      closeSetting: function () {
        this.showSetting = false;
      },
      logout: function () {
        let that = this;
        fetch(serverUrl + '/api/logout', {
          method: 'POST',
          credentials: 'include',
          mode: 'cors',
          cache: 'default'
        }).then((res) => {
          return res.json();
        }).then((data) => {
          if (data.status === 'success') {
            that.closeSetting();
            that.show = 'none';
            that.logedIn = false;
          }
        }).catch((err) => {
          return err.toString();
        });
        this.clearInfo();
      },
      clearInfo: function () {
        this.user = {
          id: null,
          name: '',
          email: '',
          avatar: '',
          thumb: ''
        };
        this.works = [];
      },
      userUpdate: function () {
        let data = {
          username: this.user.name
        };
        fetch(serverUrl + '/api/update', {
          method: 'POST',
          credentials: 'include',
          body: JSON.stringify(data),
          mode: 'cors',
          cache: 'default'
        }).then((res) => {
          return res.json();
        }).then((data) => {
          if (data.status === 'success') {
            showToast('修改成功', '#69f0ae');
          }
        }).catch((err) => {
          return err.toString();
        });
      },
      choseAvatar: function (e) {
        let file = e.target.files[0];
        this.user.thumb = URL.createObjectURL(file);
        this.options.img = URL.createObjectURL(file);
        this.options.show = true;
      },
      uploadAvatar: function () {
        let data = new FormData();
        this.$refs.cropper.startCrop();
        this.$refs.cropper.getCropData((dt) => {
          this.user.thumb = dt;
          let blob = getBlobBydataURI(dt, 'image/jpeg');
          data.append('avatar_file', blob, 'file_' + Date.parse(new Date()) + '.jpg');
          fetch(serverUrl + '/api/changeAvatar', {
            method: 'POST',
            credentials: 'include',
            body: data,
            mode: 'cors',
            cache: 'default'
          }).then((res) => {
            return res.json();
          }).then((data) => {
            if (data.status === 'success') {
              showToast('头像修改成功', '#69f0ae');
            }
          }).catch((err) => {
            showToast('修改失败 TAT');
            return err.toString();
          });
        });
        this.options.show = false;
      }
    },
    watch: {
      logedIn: function (v) {
        let that = this;
        if (v === true) {
          let data = {
            id: this.user.id
          };
          fetch(serverUrl + '/api/getWorksByUser', {
            method: 'POST',
            credentials: 'include',
            body: JSON.stringify(data),
            mode: 'cors',
            cache: 'default'
          }).then((res) => {
            return res.json();
          }).then((data) => {
            if (data.status === 'success') {
              that.works = data.works;
            }
          });
        }
      },
      loading: function (v) {
        if (v === false) {
          setTimeout(function () {
            const bg = document.querySelector('.home-bg');
            const title = document.querySelector('#title');
            bg.style.transition = 'none';
            if (title) {
              title.style.transition = 'none';
            }
            elParallax([{
              element: bg,
              perspective: false,
              multiple: 0.01
            }, {
              element: title,
              perspective: false,
              multiple: 0.04
            }]);
          }, 1000);
        }
      }
    }
  };
</script>

<style lang="scss">
    #avatar{
        display: none;
    }
    #title{
        width: 200px;
        margin-top: 50px;
        transition: 1s;
    }
    .cropper{
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        margin: auto;
    }
    .home-ctn{
        position: relative;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        background: rgba(0,0,0,.1);
        user-select: none;
        transition: 1s;
    }
    .home-ctn-in{
        background: rgba(0,0,0,.3);
    }
    .user-ctn{
        position: absolute;
        width: 100vw;
        height: 100vh;
        top: 0;
        left: 0;
        text-align: center;
        transition: .3s;
    }
    .login-ctn{
        text-align: center;
    }
    .user-setting{
        position: absolute;
        right: 20px;
        top: 80px;
        background: rgba(255,255,255,.8);
        width: 250px;
        height: 350px;
        box-shadow: 0 0 20px 1px rgba(0,0,0,.5);
    }
    .user-setting h6{
        font-weight: 200;
        font-size: 20px;
    }
    .user-setting input[type=text]{
        text-align: center;
    }

    .user-setting-btn{
        position: absolute;
        right: 40px;
        top: 20px;
        cursor: pointer;
        font-size: 24px;
        color: #fff;
        transition: .3s;
    }
    .user-setting-btn:hover{
        text-shadow: 0 0 5px rgba(255,255,255,.6);
    }
    .user-avatar{
        display: inline-block;
        width: 150px;
        height: 150px;
        line-height: 150px;
        margin-top: 100px;
        margin-bottom: 50px;
        border: 4px #fff solid;
        border-radius: 50%;
        overflow: hidden;
        cursor: pointer;
        transition: .3s;
    }
    .user-avatar:hover{
        box-shadow: 0 0 10px 2px rgba(255,255,255,.6);
        text-shadow: 0 0 5px rgba(255,255,255,.6);
    }
    .default-avatar{
        font-size: 120px;
        font-weight: 100;
        color: #fff;
    }
    .user-info{
        color: #fff;
        font-size: 34px;
        letter-spacing: 5px;
        text-indent: 5px;
        height: 40px;
    }
    .home-desc_top{
        position: absolute;
        top: 30px;
        left: 50px;
        font-size: 20px;
        color: #fff;
    }
    .home-desc_bottom{
        position: absolute;
        bottom: 30px;
        right: 50px;
        font-size: 20px;
        color: #fff;
    }
    .home-bg{
        position: absolute;
        top: -10px;
        left: -10px;
        right: -20px;
        bottom: -10px;
        margin: auto;
        background: url("../assets/img/huiyin.jpg");
        background-size: cover;
        transition: 1s;
        z-index: -1;
        /*filter: blur(10px);*/
    }
    .home-title{
        display: inline-block;
        font-size: 44px;
        color: #fff;
        line-height: 1;
        margin-top: 30vh;
        letter-spacing: 50px;
        text-indent: 50px;
    }
    .home-btns{
        margin-top: 50px;
        text-align: center;
    }
    .home-btn {
        display: inline-block;
        width: 120px;
        height: 40px;
        margin: 0 30px;
        color: #fff;
        border: 1px #fff solid;
        line-height: 40px;
        cursor: pointer;
        transition: .3s;
    }
    .home-btn:hover{
        box-shadow: 0 0 10px 2px rgba(255,255,255,.3);
        text-shadow: 0 0 10px rgba(255,255,255,.3);
    }
    .shining-btn{
        position: absolute;
        left: 0;
        right: 0;
        bottom: 100px;
        display: inline-block;
        width: 40px;
        height: 40px;
        line-height: 40px;
        font-size: 16px;
        margin: auto;
        color: #fff;
        border: 1px #fff solid;
        cursor: pointer;
        border-radius: 50%;
        transition: .3s;
        animation: shining 2s ease-in-out infinite;
    }
    .shining-btn:hover{
        animation-play-state: paused;
        color: #e35d5f;
        text-shadow: 0 0 20px #e35d5f;
    }
    .home-btn_logout{
        position: absolute;
        left: 40px;
        bottom: 20px;
        border: 1px #ef5350 solid;
        cursor: pointer;
        color: #ef5350;
    }
    .home-btn_logout:hover{
        box-shadow: 0 0 10px 1px rgba(255,0,0,.3);
        text-shadow: 0 0 5px rgba(255,0,0,.3);
    }

    .slide-fade-enter-active {
        transition: all .3s ease;
    }
    .slide-fade-leave-active {
        transition: all .3s ease;
    }
    .slide-fade-enter, .slide-fade-leave-active {
        transform: translateY(-20px);
        opacity: 0;
    }

    @keyframes shining {
        0% {
            box-shadow: 0 0 10px 2px rgba(255,255,255,.3);
        }
        50% {
            box-shadow: 0 0 20px 4px rgba(255,255,255,.8);
        }
        100% {
            box-shadow: 0 0 10px 2px rgba(255,255,255,.3);
        }
    }
</style>
